@model QuoteCalculator.Models.BaggageModel

@{
    ViewBag.Title = "Baggage";
}


@*<div class="page-breadcrumb text-center font-nr mb-2">
        <ul>
            <li><a href="#">Home</a></li>
            <li><a href="#">Quote</a></li>
            <li><a href="#">Your international move</a></li>
            <li><a href="#">Move detail</a></li>
            <li><a href="#">Removal service selection</a></li>
            <li><a href="#">Baggage</a></li>
        </ul>
    </div>*@
<h1 class="text-primary text-center mb-4"><b>Here are your quotes!</b></h1>
<div class="row justify-content-center">
    <div class="col-md-7 my-4">
        <ul class="progress-steps">
            <li class="active disabled">First Step</li>
            <li class="active disabled">Second Step</li>
            <li class="active">Third Step</li>
        </ul>
    </div>
    <div class="col-12 mt-5">
        <div class="pt-4">
            <div class="row justify-content-between">
                <div class="col-sm-auto">

                    @if (@HttpContext.Current.Request.Url.GetLeftPart(UriPartial.Authority) == @System.Configuration.ConfigurationManager.AppSettings["PicfordUrl"])
                    {
                        //Pickford
                        <h5>Quote Number: <span class="text-success">PF<span>@ViewBag.ReferenceNo</span></span></h5>
                    }
                    else if (@HttpContext.Current.Request.Url.GetLeftPart(UriPartial.Authority) == @System.Configuration.ConfigurationManager.AppSettings["ExcessUrl"])
                    {
                        //Excess
                        <h5>Quote Number: <span class="text-success">EI<span>@ViewBag.ReferenceNo</span></span></h5>
                    }
                    else
                    {
                        //Anglo Pacific
                        <h5>Quote Number: <span class="text-success">AP<span>@ViewBag.ReferenceNo</span></span></h5>
                    }
                </div>
                <div class="col-sm-auto">
                    <a class="btn btn-outline-secondary" href="@Url.Action("Index","Baggage",new { @baggageId =  CommonHelper.Encode( @SessionHelper.BaggageId.ToString() )})">New Quote</a>
                    <a class="btn btn-outline-secondary" href="@Url.Action("Index","MyQuote")">My Quotes</a>
                </div>
            </div>
        </div>
    </div>
    <div class="col-12">
        <div class="border-bottom py-4">
            <h5 class="text-uppercase text-success"><b>YOUR SELECTION:</b></h5>
            <b>From @ViewBag.FromCity, @ViewBag.FromCountry to @ViewBag.ToCity, @ViewBag.ToCountry</b>
            <br>
            @if (Model != null)
            {
                <span>
                    @foreach (var cartonItem in Model.cartonList)
                    {
                        @cartonItem.FullSizeCartonStr <br />
                    }
                    @foreach (var additionalItem in Model.moveList)
                    {
                        @additionalItem.FullSizeMoveStr <br />
                    }
                </span>
            }
        </div>
    </div>
    <div class="col-12">
        @if (Model.calculationLines.Count > 0)
        {
            <h5 class="my-4"><b><span class="text-uppercase text-success">YOUR QUOTE</span> <small>(Select an option)</small></b></h5>
            <ul class="quotes-list">
                @*<table class="table mb-0">*@
                @for (int i = 0; i < Model.calculationLines.Count; i++)
                {
                    <li>
                        <div class="row mt-2">
                            <div class="col mt-2">
                                <div class="row justify-content-between">
                                    @* <div width="50" class="border-0"><span class="quote-opt-no font-lg text-success">@(i + 1)</span></div>*@
                                    <div class="col border-0 mt-2 "><span class="" id="quotekey_@i"><b>@Model.calculationLines[i].DeliveryMethodName</b></span></div>
                                    <div class="col border-0 mt-2 ">
                                        @if (Model.calculationLines[i].DeliveryMethodName == "Sea Freight To Door")
                                        {
                                            <span class="text-success" style="display:block">@Model.calculationLines[i].CalcDescription </span>
                                            <span>@Model.calculationLines[i].TransitionTime</span>
                                            <span class="text-success">(average)</span>
                                        }
                                        else
                                        {
                                            <span class="text-success">@Model.calculationLines[i].CalcDescription </span>
                                            <span>@Model.calculationLines[i].TransitionTime</span>
                                        }
                                    </div>
                                    <div class="col border-0 mt-2" style="font-size: large; font-weight: bold;"><span class="text-success">Price £</span><span id="quotePrice_@i">@Model.calculationLines[i].Amount.ToString("F") </span></div>
                                </div>
                            </div>

                            <div class="col-auto mt-2">
                                @if (Model.calculationLines[i].isSelected == true)
                                {<div width="180" class="border-0"><button class="btn btn-success" id="method_@i" disabled><i class="icon-check2 font-lg"></i><span> Booked</span></button></div>
                                }
                                else
                                {
                                    if (ViewBag.isMethodSelected == true)
                                    {
                                        <div width="180" class="border-0"><button class="btn btn-outline-secondary" disabled><i class="icon-point-right font-lg"></i> <span>Book Now</span></button></div>
                                    }
                                    else
                                    {
                                        <div width="180" class="border-0"><button class="btn btn-outline-secondary" id="quoteOption_@i" onclick="QuoteConfirm(this,@Model.calculationLines.Count)"><i class="icon-point-right font-lg" id="quoteOption_@i"></i><span id="quoteSpan_@i"> Book Now </span></button></div>
                                    }
                                }
                            </div>
                        </div>
                    </li>
                }
                @*</table>*@
            </ul>
            if (@ViewBag.FromCountry == "UNITED KINGDOM")
            {
    <div class="row">
        <div class="col-lg-6 col-12">
            <small style="color:gray">
                @if (Model.HasMainCartons && ViewBag.DeliveryCharge == 0)
                {
                    <span>Delivery of flat pack cartons to @ViewBag.FromCity Free</span>
                }
                else if (Model.HasMainCartons && ViewBag.DeliveryCharge > 0)
                {
                    <span>Delivery of flat pack cartons to @ViewBag.FromCity £@ViewBag.DeliveryCharge</span>
                }
                else if (!Model.HasMainCartons && ViewBag.DeliveryCharge == 0)
                {
                    <span>Delivery of packing materials to @ViewBag.FromCity Free (if required)</span>
                }
                else
                {
                    <span>Delivery of packing materials to @ViewBag.FromCity £@ViewBag.DeliveryCharge (if required)</span>
                }
            </small>
        </div>
    </div>
                <div class="row">
                    <div class="col-lg-6 col-12">
                        <small style="color:gray">
                            Collection of packed items from <span>@ViewBag.FromCity</span>
                            @if (@ViewBag.CollectionCharge > 0)
                            {
                                <span>£</span><span>@ViewBag.CollectionCharge</span>
                            }
                            else
                            {
                                <span>Free</span>
                            }
                        </small>
                    </div>
                    <div class="col-lg-6 col-12">
                        @if (ViewBag.InternalNotes != null)
                        {
                            <span style="white-space:pre-line"> <b> @ViewBag.InternalNotes </b> </span>
                        }
                    </div>
                </div>
            }
            if (SessionHelper.COMPANY_ID == 1)
            {
                <div class="mt-2">
                    <span class="col-12 text-success"><b>We'll Match Any Genuine Quote From A British Association Of Removers (BAR) Bonded Company. Call Us On 0800 783 5322</b></span>
                    <div class="paragraphheading" style="color:#294694;text-transform:capitalize;font-weight:bold;font-family:Hind, sans-serif;"></div>
                    <i>At the time of providing this quote, the UK is experiencing increased risk from the coronavirus and the concern is that the number of confirmed cases of the virus will very likely increase. The Government has stated that it will be implementing (as yet) unspecified measures to combat the spread of the virus. In the extremely unlikely event that such measures are put in place which impact our ability to provide services to you (including but not limited to us having to suspend or cancel in full the services), or the virus otherwise affects our ability to fulfil your relocation, we will not be in a position to accept any liability for any losses that may arise and we limit our liability accordingly. We are keeping the matter under careful review and will ensure that all customers are advised of any developments that may affect fulfilment of contracted services</i>
                </div>
            }
            else if (SessionHelper.COMPANY_ID == 2)
            {
                <div class="mt-2">
                    <span class="col-12 text-success"><b>Sea and road freight rates are calculated on volume in cubic feet. Air freight and Courier rates are calculated on the greater of volumetric weight or actual gross weight in kilos. The volumetric weight (Vol kgs) is indicated in our above quote based on the items you have selected for shipment. Your consignment will be weighed at our depot to verify actual gross weight. Please note any package by courier service exceeding 30 kilos gross weight or 150 cms in length will attract a surcharge of £40. We are unable to accept any package on our courier service that exceeds 70 kgs or 240(L) x 120 (B) x 150 (H) cms or 419 cms in length and girth combined (length + 2 x breadth + 2 x height). Once your consignment has been despatched, should we be required to make an Entry Amendment to any information previously supplied in order to clear customs or facilitate delivery eg change of delivery address; then a surcharge of £30 applies.</b></span>
                    <div class="paragraphheading" style="color:#294694;text-transform:capitalize;font-weight:bold;font-family:Hind, sans-serif;"></div><div class="standout-box" style="background-color:#ffedd1;border-radius:6px;border:1px solid rgb(254, 153, 0);margin:15px 0px;color:#415261;font-family:Hind, sans-serif;"><div style="margin:15px;font-size:0.85em;line-height:1.33em;">Pickfords, the UK’s leading international removal company moves more people overseas to more destinations than any other removal company. We have access to the global resources of one of the world’s most trusted international removal networks and have the expertise and resources to move you to any country in the world.</div></div>
                    <i>At the time of providing this quote, the UK is experiencing increased risk from the coronavirus and the concern is that the number of confirmed cases of the virus will very likely increase. The Government has stated that it will be implementing (as yet) unspecified measures to combat the spread of the virus. In the extremely unlikely event that such measures are put in place which impact our ability to provide services to you (including but not limited to us having to suspend or cancel in full the services), or the virus otherwise affects our ability to fulfil your relocation, we will not be in a position to accept any liability for any losses that may arise and we limit our liability accordingly. We are keeping the matter under careful review and will ensure that all customers are advised of any developments that may affect fulfilment of contracted services</i>
                </div>
            }
            else if (SessionHelper.COMPANY_ID == 3)
            {
                <div class="mt-2">
                    @*<span class="col-12 text-success"><b>Sea and road freight rates are calculated on volume in cubic feet. Air freight and Courier rates are calculated on the greater of volumetric weight or actual gross weight in kilos. The volumetric weight (Vol kgs) is indicated in our above quote based on the items you have selected for shipment. Your consignment will be weighed at our depot to verify actual gross weight. Please note any package by courier service exceeding 30 kilos gross weight or 150 cms in length will attract a surcharge of £40. We are unable to accept any package on our courier service that exceeds 70 kgs or 240(L) x 120 (B) x 150 (H) cms or 419 cms in length and girth combined (length + 2 x breadth + 2 x height). Once your consignment has been despatched, should we be required to make an Entry Amendment to any information previously supplied in order to clear customs or facilitate delivery eg change of delivery address; then a surcharge of £30 applies.</b></span>
                        <div class="paragraphheading" style="color:#294694;text-transform:capitalize;font-weight:bold;font-family:Hind, sans-serif;"></div><div class="standout-box" style="background-color:#ffedd1;border-radius:6px;border:1px solid rgb(254, 153, 0);margin:15px 0px;color:#415261;font-family:Hind, sans-serif;"><div style="margin:15px;font-size:0.85em;line-height:1.33em;">Pickfords, the UK’s leading international removal company moves more people overseas to more destinations than any other removal company. We have access to the global resources of one of the world’s most trusted international removal networks and have the expertise and resources to move you to any country in the world.</div></div>*@
                    <i>At the time of providing this quote, the UK is experiencing increased risk from the coronavirus and the concern is that the number of confirmed cases of the virus will very likely increase. The Government has stated that it will be implementing (as yet) unspecified measures to combat the spread of the virus. In the extremely unlikely event that such measures are put in place which impact our ability to provide services to you (including but not limited to us having to suspend or cancel in full the services), or the virus otherwise affects our ability to fulfil your relocation, we will not be in a position to accept any liability for any losses that may arise and we limit our liability accordingly. We are keeping the matter under careful review and will ensure that all customers are advised of any developments that may affect fulfilment of contracted services</i>
                </div>
            }

        }
        else
        {
            <div class="mt-4">
                <p>
                    Thank you for inquiry. We will get back soon.
                </p>
            </div>
        }
    </div>
    <div class="col-12">
        <div class="border-top pt-4">
            <div class="row justify-content-between">
                @*<div class="col-sm-auto">
                        <button class="btn btn-secondary btn-lg rounded-pill d-flex align-items-center justify-content-center" onclick="location.href = '@Url.Action("MoveDetails","Baggage")'"><span class="pl-2" style="transform: rotate(180deg);">&#x27A1;</span> Back</button>
                    </div>*@
                @*<div class="col-sm text-center">
                        <p class="mb-0 text-danger text-uppercase">Attention</p>
                        <p>No option has been selected above. Plesae select one to countinue.</p>
                    </div>*@
                @*<div class="col-sm-auto">
                        <button class="btn btn-warning btn-lg rounded-pill d-flex align-items-center justify-content-center">Next <span class="pl-2">&#x27A1;</span></button>
                    </div>*@
            </div>
        </div>
    </div>
</div>

@if (Model.calculationLines.Count > 0)
{
    <div id="QuoteDetails" style="width:100%;margin-top: 20px;">

    </div>
}
@*<script src="js/jquery-3.3.1.slim.min.js"></script>
    <script src="js/bootstrap.bundle.min.js"></script>
    <script src="js/owl.carousel.min.js"></script>*@
<script>
    $(document).ready(function () {
        /* accordion */
        $(".move-journey .collapse.show").each(function () {
            $(this).prev("h2").find(".bx").addClass("bx-minus").removeClass("bx-plus");
        });
        $(".move-journey .collapse").on('show.bs.collapse', function () {
            $(this).prev("h2").find(".bx").removeClass("bx-plus").addClass("bx-minus");
        }).on('hide.bs.collapse', function () {
            $(this).prev("h2").find(".bx").removeClass("bx-minus").addClass("bx-plus");
        });

        /* review slider */
        var reviewSlider = $("#reviewSlider");
        reviewSlider.owlCarousel({
            margin: 40,
            loop: true,
            autoplay: true,
            dots: false,
            responsive: {
                0: {
                    items: 1
                },
                992: {
                    items: 2
                },
                1200: {
                    items: 3
                }
            }
        });
        LoadQuoteDetails();
    });

     function saveCompleted(data)
    {
         if (data == "") {
             location.href = '@Url.Action("ThankYou", "Vehicle")';
            @*var urllink = '@Url.Action("Index", "Baggage")';
            window.location.href = urllink;*@
        }
    }

    function QuoteConfirm(e, count) {
        var btnId = e.id;
        bootbox.confirm("Are you sure you want to book now?", function (result) {
            buttons: {
                cancel: {
                    label: "No",
                        className: "btn-cancel min-auto cancel"
                },
                confirm: {
                    label: "Yes",
                        className: "btn-warning min-auto  confirm"
                }
            },
            if (result) {
                var quotekey = $("#quotekey_" + btnId.split('_')[1]).text();
                var quotePrice = $("#quotePrice_" + btnId.split('_')[1]).text();

                for (var i = 0; i < count; i++) {
                    if (i != btnId.split('_')[1]) {
                        $("#quoteOption_" + [i]).removeClass("btn btn-success");
                        $("#quoteOption_" + [i]).addClass("btn btn-warning");
                        $("#quoteSpan_" + [i]).text("Book Now");
                        $("#quoteOption_" + [i]).attr("disabled", "disabled");
                    }
                }

                $("#" + btnId).removeClass("btn btn-warning");
                $("#" + btnId).addClass("btn btn-success");
                $("#quoteSpan_" + btnId.split('_')[1]).text("Booked");
                $("#quoteOption_" + btnId.split('_')[1]).attr("disabled", "disabled");
                var url = '@Url.Action("BaggageQuoteCal", "Baggage")';
                var data = {
                            'colName': quotekey,
                            'quotePrice': quotePrice,
                            'quoteNo': @SessionHelper.BaggageId
                            };
                callwebservice(url,data, saveCompleted, false, datatypeEnum.text, typeEnum.post);
            }
        });
        $(".prod_view").remove();
        $(".modal-dialog").css("margin-top","340px");
    }
</script>
