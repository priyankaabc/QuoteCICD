@*<div class="page-breadcrumb text-center font-nr mb-2">
    <ul>
        <li><a href="@Url.Action("Index","Home")">Home</a></li>
        <li><a href="#">Get a quote</a></li>
        <li><a href="#">Your international move</a></li>
        <li><a href="#">Move details</a></li>
        <li><a href="#">Removal service selection</a></li>
        <li><a href="#">Video Survey</a></li>
    </ul>
</div>*@

<h1 class="text-primary text-center mb-4"><b>Arrange a free video survey</b></h1>

<div class="row justify-content-center">
    <div class="col-md-9 my-4">
        <ul class="progress-steps">
            <li class="active disabled">About You</li>
            <li class="active disabled">Quote Type</li>
            <li class="active">Move Details</li>
        </ul>
    </div>
    <div class="col-md-9">
        <p class="text-center">We will need to arrange a survey of the goods you want to move.</p>
        <p class="text-center">Your quote will be based on the volume we assess at your survey.</p>
    </div>
    <div class="col-md-9">
        @*<img src="~/Content/images/video-survey.jpg" alt="image" />*@
        @*<iframe src="https://widget.gobuzzsurvey.com/static?key=bb1e696e-27e9-4d05-9123-514cb535642e&amp;dateFormat=en-GB" id="myIframe" class="videoSurvey-iframe" style="height: 740px; width:100%;"></iframe>*@
    </div>
    <div class="col-12">
        <div class="row">
            <div class="col-md-6 form-group">
                @Html.DropDownList("DayScheduleId", new SelectList(ViewBag.DayScheduleList, "Id", "Name"), "- Select -", new { @class = "form-control ", @placeholder = "Type Here" })
            </div>
            <div class="col-md-6 form-group">
                <div class="input-group date" id="EstimatedMoveDateDiv">
                    <input type="text" name="EstimatedMoveDate" id="EstimatedMoveDate" class="form-control" placeholder="dd/mm/yyyy">
                    <div class="input-group-append input-group-addon">
                        <span class="input-group-text"><i class="bx bx-calendar-alt font-md"></i></span>
                    </div>
                </div>
            </div>
        </div>
    </div>    
    <div class="col-12 mt-5">
        <div class="border-top pt-4">
            <div class="row justify-content-between journey-btns">
                <div class="col-sm-auto order-md-12">
                    <button type="submit" class="btn btn-warning btn-lg rounded-pill d-flex align-items-center justify-content-center" id="nextButton" onclick="return SaveHomeVideoSurveyDetails()">Next <span class="pl-2">&#x27A1;</span></button>
                </div>
                <div class="col-sm-auto">                    
                    <a class="btn btn-link btn-lg rounded-pill d-flex align-items-center justify-content-center" href="@Url.Action("RemovalServiceSelection","InternationalRemoval")"><span class="pl-2" style="transform: rotate(180deg);">&#x27A1;</span> Back</a>
                </div>
            </div>
        </div>
    </div>
    @*<div class="col-12 mt-4">
        <p class="mb-2"><b>Choose another option?</p>
        <ul class="option-links">
            <li><a href="#">Book a home survey</a></li>
            <li>|</li>
            <li><a href="#">Book a video survey</a></li>
            <li>|</li>
            <li><a href="#">Baggage Only</a></li>
        </ul>
    </div>*@
</div>

<script>
    $(document).ready(function (e) {
        $('#EstimatedMoveDateDiv').datepicker({
            format: 'dd/mm/yyyy',
            startDate: new Date()
        }).on('change', function () {
            $('.datepicker').hide();
        });
    });

    window.addEventListener('message', function (event) {
        var json;
        var model = @Html.Raw(Json.Encode(Model));
        var myIframe = document.getElementById('myIframe');
        var origin = event.origin || event.originalEvent.origin; // For Chrome, the origin property is in the event.originalEvent object.
        //if (origin !== /*the container's domain url*/)
        //    return;
        if (typeof event.data == 'object' && event.data.call == 'sendValue') {
            // Do something with event.data.value;
        }
        if (event.data.hasOwnProperty('appMounted')) {
            json = { "updateContactInfo": { "firstName": model.firstName, "title": model.title, "surName": model.surName, "email": model.email, "mobileNumber": model.mobileNumber, "addressPickup": model.addressPickup, "addressDropoff": model.addressDropoff } };
            myIframe.contentWindow.window.postMessage(json, "*");
        }
        else if (event.data.hasOwnProperty('iframeHeightSize')) {
            console.log("Set iframe height: " + event.data.iframeHeightSize);
            $('iframe').css('height', event.data.iframeHeightSize);
        }
        else if (event.data.hasOwnProperty('formSubmissionSuccess')) {
            var id = event.data.formSubmissionSuccess.id;
            var appointmentTime = event.data.formSubmissionSuccess.appointmentTime;

             $.ajax({
                 url: '@Url.Action("SaveHomeVideoSurvey", "InternationalRemoval")',
                 async: false,
                 type: 'POST',
                 data: { 'quoteId': model.QuoteId, 'id': id, 'appointmentTime': appointmentTime },
                 success: function (data) {
                     if (data.IsSuccess) {
                         location.href = "@Url.Action("HomeVideoSurveyThankyou", "InternationalRemoval")?quoteId=" + model.QuoteId;
                         @*location.href = "@Url.Action("HomeVideoSurveyThankyou", "InternationalRemoval", new { quoteId = CommonHelper.Encode(Model.QuoteId) })"*@
                         //SucessMessage(data.Message);
                     }
                     else {
                         ShowErrorMessage(data.Message);
                     }
                },
            })
        }
        else if (event.data.hasOwnProperty('formSubmissionError')) {
            
        }
    }, false);

    function SaveHomeVideoSurveyDetails() {
        if ($("#EstimatedMoveDate").val() != "" && $("#DayScheduleId").val() != "") {
            var appointmentTime = $("#EstimatedMoveDate").val();
            var dayScheduleId = $("#DayScheduleId").val();
            $.ajax({
                url: '@Url.Action("HomeVideoSurveyThankyou", "InternationalRemoval")',
                async: false,
                type: 'POST',
                data: { 'dayScheduleId': dayScheduleId, 'appointmentTime': appointmentTime },
                success: function (data) {
                    if (data.IsSuccess) {
                        var url = window.location.href = '@Url.Action("ThankYou", "InternationalRemoval")?survey=' + "Video"; 
                        //var paramValue = { 'survey': 'Video'};
                        //callwebservice(url, paramValue, "", false, datatypeEnum.text, typeEnum.post);
                    }
                    else {
                        ShowErrorMessage(data.Message);
                    }
                },
            })
        } else {

            if ($("#DayScheduleId").val() == "") {
                ShowErrorMessage("Please Select Day Schedule");
                return false;
            } 
            if ($("#EstimatedMoveDate").val() == "") {
                ShowErrorMessage("Please Select Estimate Date");
                return false;
            }                           
        }
    }
</script>