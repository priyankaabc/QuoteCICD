<style>
    .customli li {
        list-style: disc;
        margin: 0;
        padding: 0;
    }
</style>
<script src="~/Scripts/Common.js"></script>

@model QuoteCalculator.Service.Models.BaggageModel

@{
    ViewBag.Title = "Baggage";
}
<style type="text/css" media="print">
    .NonPrintable {
        display: none;
    }

    .nowrap {
        white-space: nowrap;
    }

    .PrintableLogo {
        display: block !important;
    }

    .hidescrollonprint {
        overflow: hidden
    }
</style>
<style type="text/css">
    .PrintableLogo {
        display: none;
    }

    .NonPrintable h1 {
        color: #1b3b81;
    }

    .text-success {
        color: #03654d !important
    }
</style>

<div class="container">
    <div class="row">
        <div class="col-sm-12">
            <div class="card">
                <div class="card-body p-5">
                    @if (Model.baggageQuote != null)
                    {
                        <div class="row">
                            <div class="col-sm-12">
                                <div class="PrintableLogo">
                                    @if (Model.baggageQuote != null)
                                    {
                                        if (Model.baggageQuote.Company == 1)
                                        {
                                            <img src="/Content/img/logo.png" alt="Anglo Pacific">
                                        }
                                        else if (Model.baggageQuote.Company == 2)
                                        {
                                            <img src="/Content/img/pf_logo.png" alt="Pickfords">
                                        }
                                        else if (Model.baggageQuote.Company == 3)
                                        {
                                            <img src="~/Content/img/eb_logo.jpg" alt="Excess International Movers">
                                        }
                                    }
                                </div>
                                <div class="NonPrintable">
                                    <h1 class="mb-30"><b>Here are your quotes!</b></h1>
                                </div>
                                <div class="row align-items-center mb-3">
                                    <div class="col-lg-6 col-12">
                                        <p class="h6">Quote Number: <span class="text-success">@ViewBag.CompanyShortCode<span>@ViewBag.ReferenceNo</span></span></p>
                                    </div>
                                    <div class="col-lg-6 col-12 text-right NonPrintable">
                                        <a class="btn btn-warning" href="@Url.Action("AddEdit", "Baggage", new { Id = Model.baggageQuote.Id })">Edit Quote</a>
                                        <a class="btn btn-warning" href="@Url.Action("ViewMyQuote", "Baggage", new { Id = Model.baggageQuote.Id, email = Model.baggageQuote.Email })">View Quotes</a>
                                        <a class="btn btn-warning" href="#" onclick="PrintQuoteDetails()">Print Quote</a>
                                    </div>
                                </div>
                                <div>
                                    <div class="border-top py-3">
                                        <h5 class="text-success"><b>YOUR SELECTION:</b></h5>
                                        <p class="pb-3"><b>From @ViewBag.FromCity, @ViewBag.FromCountry to @ViewBag.ToCity, @ViewBag.ToCountry</b></p>
                                        @if (Model != null)
                                        {
                                            <p class="mb-3">
                                                @foreach (var cartonItem in Model.cartonList)
                                                {
                                                    @cartonItem.FullSizeCartonStr
                                                    <br />
                                                }
                                                @foreach (var additionalItem in Model.moveList)
                                                {
                                                    @additionalItem.FullSizeMoveStr
                                                    <br />
                                                }
                                            </p>
                                        }

                                    </div>
                                </div>
                            </div>



                            <div class="col-sm-12">
                                @if (Model != null && Model.calculationLines.Count > 0)
                                {
                                    <h5 class="my-20"><b><span class="text-uppercase text-success">YOUR QUOTE</span> <small>(Select an option)</small></b></h5>
                                    <div class="table-responsive hidescrollonprint ">
                                        <table class="table mb-0 nowrap table-bordered">
                                            @for (int i = 0; i < Model.calculationLines.Count; i++)
                                            {
                                                <tr>
                                                    <td valign="middle" width="50" class="border-0"><span class="quote-opt-no font-lg text-success">@(i + 1)</span></td>
                                                    <td valign="middle" class="border-0"><span class="text-success" id="quotekey_@i"><b>@Model.calculationLines[i].DeliveryMethodName</b></span></td>
                                                    <td valign="middle" class="border-0">
                                                        <span class="text-success">@Model.calculationLines[i].CalcDescription </span>
                                                        @if (Model.calculationLines[i].DeliveryMethodName == "Sea Freight To Door")
                                                        {
                                                            <span class="text-success">(average)</span>
                                                        }
                                                        <span>@Model.calculationLines[i].TransitionTime</span>
                                                    </td>
                                                    <td valign="middle" class="border-0"><span class="text-success">Price </span>£<span id="quotePrice_@i"> @Model.calculationLines[i].Amount </span></td>

                                                    @*<td valign="middle" width="150" class="border-0"><button class="btn btn-warning btn-rounded" id="quoteOption_@i" onclick="QuoteConfirm(this,@Model.calculationLines.Count)"><i class="bx bx-check font-lg"></i><span id="quoteSpan_@i"> Book Now </span></button></td>*@
                                                    @if (Model.calculationLines[i].isSelected == true)
                                                    {
                                                        <td valign="middle" width="180" class="border-0"><button class="btn btn-warning" disabled><i class="icon-check2 font-lg"></i> <span>Booked</span></button></td>
                                                    }
                                                    else
                                                    {
                                                        if (ViewBag.isMethodSelected == true)
                                                        {
                                                            <td valign="middle" width="180" class="border-0"><button class="btn btn-warning" disabled><i class="icon-point-right font-lg"></i><span> Book Now</span></button></td>
                                                        }
                                                        else
                                                        {
                                                            <td valign="middle" width="180" class="border-0"><button class="btn btn-warning" id="quoteOption_@i" onclick="QuoteConfirm(this, @Model.calculationLines.Count)"><i class="icon-point-right font-lg"></i><span id="quoteSpan_@i"> Book Now </span></button></td>
                                                        }
                                                    }

                                                </tr>
                                            }
                                        </table>
                                    </div>
                                    if (@ViewBag.FromCountry == "UK")
                                    {
                                        <div class="row">
                                            <div class="col-sm-6">
                                                @if (Model.HasMainCartons && ViewBag.DeliveryCharge == 0)
                                                {
                                                    <span>Delivery of flat pack cartons to @ViewBag.FromCity Free</span>
                                                }
                                                else if (Model.HasMainCartons && ViewBag.DeliveryCharge > 0)
                                                {
                                                    <span>Delivery of flat pack cartons to @ViewBag.FromCity £@ViewBag.DeliveryCharge</span>
                                                }
                                                else if (!Model.HasMainCartons && ViewBag.DeliveryCharge == 0)
                                                {
                                                    <span>Delivery of packing materials to @ViewBag.FromCity Free (if required)</span>
                                                }
                                                else
                                                {
                                                    <span>Delivery of packing materials to @ViewBag.FromCity £@ViewBag.DeliveryCharge (if required)</span>
                                                }
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-sm-6">
                                                Collection of packed items from <span>@ViewBag.FromCity</span>
                                                @if (@ViewBag.CollectionCharge > 0)
                                                {
                                                    <span>£</span><span>@ViewBag.CollectionCharge</span>
                                                }
                                                else
                                                {
                                                    <span>Free</span>
                                                }
                                            </div>
                                        </div>
                                        if (ViewBag.InternalNotes != null)
                                        {
                                            <div class="row">
                                                <div class="col-sm-6">
                                                    <b> Internal Notes :</b><br />
                                                    <span style="white-space:pre-line"> @ViewBag.InternalNotes </span>
                                                </div>
                                            </div>
                                        }
                                    }
                                }
                                else
                                {
                                    <div class="mt-20">
                                        <p>
                                            Thank you for inquiry. We will get back soon.
                                        </p>
                                    </div>
                                }
                            </div>
                            @if (Model != null && Model.calculationLines.Count > 0)
                            {
                                <div id="QuoteDetails" class="mt-3 w-100">
                                </div>
                            }
                        </div>


                    }
                </div>
            </div>
        </div>
    </div>
</div>
@*<div class="col-sm-auto">
        <button class="btn btn-secondary btn-lg rounded-pill d-flex align-items-center justify-content-center" onclick="location.href = '@Url.Action("MoveDetails","Baggage")'"><span class="pl-2" style="transform: rotate(180deg);">&#x27A1;</span> Back</button>
    </div>*@
@*<div class="col-sm text-center">
        <p class="mb-0 text-danger text-uppercase">Attention</p>
        <p>No option has been selected above. Plesae select one to countinue.</p>
    </div>*@
@*<div class="col-sm-auto">
        <button class="btn btn-warning btn-lg rounded-pill d-flex align-items-center justify-content-center">Next <span class="pl-2">&#x27A1;</span></button>
    </div>*@




@*<script src="js/jquery-3.3.1.slim.min.js"></script>
    <script src="js/bootstrap.bundle.min.js"></script>
    <script src="js/owl.carousel.min.js"></script>*@

<script>
    $(document).ready(function () {
        /* accordion */
        $("#menu_Baggage").addClass("active");
        $("#menu_QuoteDetails").children().removeClass("collapsed");
        $("#menu_QuoteDetails").children().addClass("show");
        $("#menu_QuoteDetails").addClass("active");

        $(".move-journey .collapse.show").each(function () {
            $(this).prev("h2").find(".bx").addClass("bx-minus").removeClass("bx-plus");
        });
        $(".move-journey .collapse").on('show.bs.collapse', function () {
            $(this).prev("h2").find(".bx").removeClass("bx-plus").addClass("bx-minus");
        }).on('hide.bs.collapse', function () {
            $(this).prev("h2").find(".bx").removeClass("bx-minus").addClass("bx-plus");
        });

        /* review slider */
        var reviewSlider = $("#reviewSlider");
        //reviewSlider.owlCarousel({
        //    margin: 40,
        //    loop: true,
        //    autoplay: true,
        //    dots: false,
        //    responsive: {
        //        0: {
        //            items: 1
        //        },
        //        992: {
        //            items: 2
        //        },
        //        1200: {
        //            items: 3
        //        }
        //    }
        //});
        LoadQuoteDetails();
    });

    function saveCompleted(data) {
        if (data == "") {
            @*var urllink = '@Url.Action("Index", "Baggage")';
            window.location.href = urllink;*@
        }
    }

    function QuoteConfirm(e, count) {
        var btnId = e.id;
        bootbox.confirm("Are you sure, you want to book this Quote?", function (result) {
            if (result) {
                var quotekey = $("#quotekey_" + btnId.split('_')[1]).text();
                var quotePrice = $("#quotePrice_" + btnId.split('_')[1]).text();

                for (var i = 0; i < count; i++) {
                    if (i != btnId.split('_')[1]) {
                        $("#quoteOption_" + [i]).removeClass("btn btn-success");
                        $("#quoteOption_" + [i]).addClass("btn btn-warning");
                        $("#quoteSpan_" + [i]).text("Book Now");
                        $("#quoteOption_" + [i]).attr("disabled", "disabled");
                    }
                }

                $("#" + btnId).removeClass("btn btn-warning");
                $("#" + btnId).addClass("btn btn-success");
                $("#quoteSpan_" + btnId.split('_')[1]).html(`<i class='fa fa-plus'></i> Booked`);
                $("#quoteOption_" + btnId.split('_')[1]).attr("disabled", "disabled");
                var url = '@Url.Action("BaggageQuoteCal", "Baggage")';
                var data = {
                    'colName': quotekey,
                    'quotePrice': quotePrice,
                    'quoteNo': @SessionHelper.BaggageQuoteId
                    };
                callwebservice(url, data, saveCompleted, false, datatypeEnum.text, typeEnum.post);
            }
        });
    }

    function PrintQuoteDetails() {
        $(".collapse").addClass("in");
        $(".k-table").css("width", "100%");
        $(".navbar-nav").addClass("d-none");
        $(".btn-warning").addClass("d-none");
        window.print();
        $(".navbar-nav").removeClass("d-none");
        $(".btn-warning").removeClass("d-none");
        $(".collapse").removeClass("in");
    }
</script>
